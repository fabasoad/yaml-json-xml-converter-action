---
name: Functional Tests

on:
  push:
    branches:
      - 'dependabot/**'
      - 'feature-**'
      - 'fix-**'
      - 'main'

jobs:
  yaml-to-json:
    name: YAML / JSON / XML
    timeout-minutes: 5
    strategy:
      matrix:
        os: ['ubuntu-latest', 'windows-latest', 'macos-latest']
    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v3
      - name: YAML to JSON
        uses: ./
        id: yaml_json
        with:
          path: '.github/workflows/fixtures/test.yaml'
          from: 'yaml'
          to: 'json'
      - name: Save JSON
        run: echo "${{ steps.yaml_json.outputs.data }}" >> yaml.json
      - name: JSON to XML
        uses: ./
        id: json_xml
        with:
          path: './yaml.json'
          from: 'json'
          to: 'xml'
      - name: Save XML
        run: echo "${{ steps.json_xml.outputs.data }}" >> json.xml
      - name: XML to YAML
        uses: ./
        id: xml_yaml
        with:
          path: './json.xml'
          from: 'xml'
          to: 'yaml'
      - name: Save YAML
        run: echo "${{ steps.xml_yaml.outputs.data }}" >> xml.yaml
      - name: Validate
        run: |
          [[ cmp -s ".github/workflows/fixtures/test.yaml" "xml.yaml" ]] || exit 1;
