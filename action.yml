---
name: 'YAML/JSON/XML Converter Action'
author: Yevhen Fabizhevskyi
description: 'This action takes file that in YAML/JSON/XML format and produces it in output in YAML/JSON/XML format.'
branding:
  icon: copy
  color: green
inputs:
  path:
    description: 'Path to the file'
    required: true
  from:
    description: 'Format of a file. Possible values: json, xml, yaml.'
    required: true
  to:
    description: 'Format of a file as a result. Possible values: json, xml, yaml.'
    required: true
outputs:
  data:
    description: 'Content of a file in a format that is defined in format_to argument.'
    value: ${{ steps.result.outputs.data }}
runs:
  using: 'composite'
  steps:
    # From YAML/JSON
    - name: JSON/YAML to JSON/XML
      uses: mikefarah/yq@v4.28.1
      if: ${{ inputs.from == 'yaml' }}
      with:
        cmd: export OUTPUT="$(yq -P '${{ inputs.path }}' -o=${{ inputs.to }})"
    # From XML
    - name: Install yq
      if: ${{ inputs.from == 'xml' }}
      run: pip install yq
      shell: bash
    - name: XML to JSON
      if: ${{ inputs.from == 'xml' && inputs.to == 'json' }}
      run: export OUTPUT="$(xq . '${{ inputs.path }}')"
      shell: bash
    - name: XML to YAML
      if: ${{ inputs.from == 'xml' && inputs.to == 'yaml' }}
      run: export OUTPUT="$(xq . '${{ inputs.path }}' | yq -y .)"
      shell: bash
    - name: Uninstall yq
      if: ${{ inputs.from == 'xml' }}
      run: pip uninstall yq
      shell: bash
    # Output
    - name: Save output
      id: result
      run: echo "::set-output name=data::$OUTPUT"
      shell: bash
